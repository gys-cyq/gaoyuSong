<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>南通科技局</title>
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
    	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    	<meta http-equiv="Cache-Control" content-type="utf-8" />
    	<link rel="stylesheet" href="static/css/font.css"  />
    	<!--<link rel="stylesheet" href="static/css/weadmin.css" />-->
        <link rel="stylesheet" href="lib/layui/css/layui.css"  />
        <link rel="stylesheet" href="css/style.css" />
        <link rel='icon' href='img/icon.png' type='image/x-ico' />
        <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
        <!--[if IE 8]>
             <script type="text/javascript" src="js/jquery-1.9.1.js"></script>
        <![endif]-->
        <script type="text/javascript" src="lib/layui/layui.js" charset="utf-8"></script>
        <style>
            html {
                width: 100%;
                height: 100%;
                overflow-x: hidden;
                overflow-y: auto;
            }
            body{
                width:100%;
                height:100%;
                background-image: url(img/login.jpg);background-size:100% 100%;background-repeat:no-repeat;font-size:18px;
                margin:0;
            }

            .loginin{
                width:100%;
                margin-top:20px;
                height: 44px;
                line-height: 44px;
                padding: 0 25px;
                font-size: 16px;
                background-color: #2fa4e7;
                color: #fff;
                border-style: none;
                cursor:pointer;
            }
            .layui-form div{
                margin:20px 0;
            }
            .layui-form div input{
                border-color:#000;
            }
        </style>
	</head>
	<body>
    <div class="login">
        <div class="login-content">
            <div class="login-header">
                <span>崇川科技局项目管理系统</span>
            </div>
            <div class="chooseType">
                <div class="typeL">
                    <span>登录</span>
                </div>
                <div class="typeR" id="skipR">
                    <span>注册</span>
                </div>
            </div>
            <form class="layui-form" style="margin-top:20px;">
                <div>
                    <input name="username" placeholder="用户名"  type="text" lay-verify="required" class="layui-input" id="usernameText" />
                </div>
                <div>
                    <input name="password" lay-verify="required" placeholder="密码"  type="password" class="layui-input" id="passwordText"/>
                </div>
                <!--<input name="username" placeholder="用户名"  type="text" lay-verify="required" class="layui-input" id="usernameText" />-->
                <!--<input name="password" lay-verify="required" placeholder="密码"  type="password" class="layui-input" id="passwordText"/>-->
                <input class="loginin" value="登录" onclick="login()"  type="button">
            </form>
        </div>
    </div>

    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript">
        $('#skipR').on('click',function(){
            location.href='register.html';
        })
        layui.use('layer',function(){
            var layer = layui.layer;
        })
        document.onkeyup = function(e){
            var ev = document.all ? window.event : e;
            if(ev.keyCode==13) {
                //激活提交按钮事件
               login();
            }
        }
        function login(){
//            var username=document.getElementById('usernameText').value.trim();
//            var password=document.getElementById('passwordText').value.trim();
            var username;
            var password;
            if(String.prototype.trim){
               username=document.getElementById('usernameText').value.trim();
               password=document.getElementById('passwordText').value.trim();
            }else{
                String.prototype.trim = function () {
                    return this.replace(/^\s*|\s*$/g, "");
                }
            }
            if(username.length == 0){
                layer.msg('登录用户名不能为空！', function(){});
                return false;
            }
            if(password.length == 0){
                layer.msg('登录密码不能为空！', function(){});
                return false;
            }
//            console.log(username+','+password);
            $.ajax({
                type:'post',
                url:baseUrl+'/login',
                dataType:'json',
                crossDomain: true == !(document.all) ,
                data:{username:username,password:password},
//                contentType : 'application/json;charset=UTF-8',
                success:function(res){
                    if(res.status==1){
                        nickname=res.data.user.nickname
                        localStorage.setItem('user',JSON.stringify(res.data.user));
                        sessionStorage.setItem("userinfo",nickname);
                        localStorage.setItem("token",res.data.token);
                        localStorage.setItem('userId',res.data.user.id);
                        localStorage.setItem('companyId',res.data.user.companyId);
                        token=res.data.token;
                        location.href="index.html";
                    }else{
                        //layer.msg(res.msg);
                        errmsg(res);
//                        console.log(res);
                    }
                },
                error:function(xhr,type,errorThrown){
//                    console.log('用户不存在');
                }
            })
        }
    </script>  
    <!-- 底部结束 -->
</body>
</html>
