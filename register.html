<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>崇川科技局项目管理系统</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="Cache-Control" content-type="utf-8" />
    <link rel="stylesheet" href="static/css/font.css"  />
    <link rel="stylesheet" href="lib/layui/css/layui.css"  />
    <link rel="stylesheet" href="css/style2.css" />
    <script type="text/javascript" src="js/main.js"></script>
    <style>


        .layui-form-item{
            width:80%;
            margin:0 auto 15px;
        }
        .layui-form-item .layui-form-label{
            padding:9px 0;
        }
        .layui-input-block{
            margin-left:100px;
            width:85%;
        }
        .layui-input-inline3{
            display:block;
            float:left;
            width:14%;
            padding:9px 15px;
            margin-bottom:15px;
            margin-left:5px;
        }

    </style>
</head>
<body>
<div class="content">
    <div class="register-header">
        <span>崇川科技局项目管理平台用户注册</span>
    </div>
        <div class="select-subject">
            <form class="layui-form" style="width:80%;margin:10px auto;">
                <select id="target" class="select-box" lay-filter="target">
                    <option value="1" id="company" selected="true">公司</option>
                    <option value="2" id="personal">个人</option>
                </select>
            </form>
            <form class="layui-form" id="parkForm">
                <div id="choose1">
                    <div class="typeR">
                        <span>企业基础信息</span>
                    </div>
                    <div class="layui-form-item2">
                        <div class="layui-inline2">
                            <lable class="layui-form-label">企业名称<span class="judgeNull">*</span></lable>
                            <div class="layui-input-inline2">
                                <input type="text"  placeholder="请输入公司名称" class="layui-input" name="name" lay-verify="required">
                            </div>
                        </div>
                        <div class="layui-inline2">
                            <lable class="layui-form-label">公司法人<span class="judgeNull">*</span></lable>
                            <div class="layui-input-inline2">
                                <input type="text" class="layui-input" name="legalPerson" lay-verify="required"/>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item2">
                            <label class="layui-form-label" style="padding:9px 0;">所属街道<span style="color:red;">*</span></label>
                            <div class="layui-input-inline3">
                                <select name="province" lay-filter="province" id="provinceList" lay-verify="required">
                                </select>
                            </div>
                            <div class="layui-input-inline3">
                                <select name="city" lay-filter="city" id="cityList" lay-verify="required">
                                </select>
                            </div>
                            <div class="layui-input-inline3">
                                <select name="country" lay-filter="country" id="countryList" lay-verify="required">
                                </select>
                            </div>
                            <div class="layui-input-inline3">
                                <select name="streetId" lay-filter="street" id="streetList" lay-verify="required">
                                </select>
                            </div>
                            <div class="layui-input-inline3">
                                <select name="parkId" lay-filter="park" id="parkList">
                                </select>
                            </div>
                    </div>
                    <div class="layui-form-item">
                            <lable class="layui-form-label">地址</lable>
                            <div class="layui-input-block">
                                <input type="text"  class="layui-input" name="address"/>
                            </div>
                    </div>
                    <div class="layui-form-item2">
                        <div class="layui-inline2">
                            <lable class="layui-form-label">联系人</lable>
                            <div class="layui-input-inline2">
                                <input type="text"  class="layui-input" name="contacts"/>
                            </div>
                        </div>
                        <div class="layui-inline2">
                            <lable class="layui-form-label">联系电话</lable>
                            <div class="layui-input-inline2">
                                <input type="text"  class="layui-input" name="contactsTel"/>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <lable class="layui-form-label">注册资金（单位：万）</lable>
                        <div class="layui-input-block">
                            <input type="text"  class="layui-input" name="registerCapital"/>
                        </div>
                    </div>
                    <div class="layui-form-item2">
                        <div class="layui-inline2">
                            <lable class="layui-form-label">员工人数</lable>
                            <div class="layui-input-inline2">
                                <input type="text"  class="layui-input" name="staffNumber"  onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')"/>
                            </div>
                        </div>
                        <div class="layui-inline2">
                            <lable class="layui-form-label">经营范围</lable>
                            <div class="layui-input-inline2">
                                <input type="text"  class="layui-input" name="operationScope"/>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                            <lable class="layui-form-label">备注</lable>
                            <div class="layui-input-block">
                                <input type="text"  class="layui-input" name="remark"/>
                            </div>
                    </div>
                    <div class="layui-form-item2">
                        <div class="layui-inline2">
                            <lable class="layui-form-label">账号<span class="judgeNull">*</span></lable>
                            <div class="layui-input-inline2">
                                <input type="text"  class="layui-input" name="account" lay-verify="required" onchange="verifyRepeat()" id="account"/>
                            </div>
                        </div>
                        <div class="layui-inline2">
                            <lable class="layui-form-label">密码<span class="judgeNull">*</span></lable>
                            <div class="layui-input-inline2">
                                <input type="text"  class="layui-input" name="password" lay-verify="required"/>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-inline" style="width:33%">
                            <button class="layui-btn" lay-submit="" lay-filter="register" style="width:100%;">确定注册</button>
                        </div>
                    </div>
                </div>
            </form>
            <form class="layui-form" id="personalForm">
                <div id="choose2" style="display:none">
                    <div class="typeR">
                        <span>个人基础信息</span>
                    </div>
                    <div class="layui-form-item2">
                        <div class="layui-inline2">
                            <lable class="layui-form-label">用户姓名<span class="judgeNull">*</span></lable>
                            <div class="layui-input-inline2">
                                <input type="text" placeholder="请输入用户名称" class="layui-input" name="username" lay-verify="required" onchange="verifyRepeat()" id="username"/>
                            </div>
                        </div>
                        <div class="layui-inline2">
                            <lable class="layui-form-label">身份证号<span class="judgeNull">*</span></lable>
                            <div class="layui-input-inline2">
                                <input type="text" class="layui-input" name="idcard" lay-verify="required|IDcard"/>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                            <lable class="layui-form-label">地址<span class="judgeNull">*</span></lable>
                            <div class="layui-input-block">
                                <input type="text"  class="layui-input" name="address" lay-verify="required"/>
                            </div>
                    </div>
                    <div class="layui-form-item2">
                        <div class="layui-inline2">
                            <lable class="layui-form-label">手机号<span class="judgeNull">*</span></lable>
                            <div class="layui-input-inline2">
                                <input type="text" class="layui-input" name="phone" lay-verify="required|phone|mobile"/>
                            </div>
                        </div>
                        <div class="layui-inline2">
                            <lable class="layui-form-label">工作单位</lable>
                            <div class="layui-input-inline2">
                                <input type="text" class="layui-input" name="company"/>
                            </div>
                        </div>
                    </div>
                    <!--<div class="layui-form-item">-->
                            <!--<lable class="layui-form-label">注册时间</lable>-->
                            <!--<div class="layui-input-block">-->
                                <!--<input type="text" class="layui-input" name="registerTime" id="registerTime"/>-->
                            <!--</div>-->
                    <!--</div>-->
                    <div class="layui-form-item">
                        <div class="layui-inline" style="width:33%">
                            <button class="layui-btn" lay-submit="" lay-filter="registerP" style="width:100%">确定注册</button>
                        </div>
                    </div>
                </div>
            </form>
            <div style="text-align:center">如果已有账号，请直接<a href="Login.html" style="color:red;">登录</a></div>
        </div>
</div>
<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="js/jquery.form.js"></script>
<script type="text/javascript" src="lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript">
    var form;
    layui.use(['form','layer'],function(){
        form = layui.form;
        var layer = layui.layer;

        getProvinceList();
        form.on('select(province)', function (data) {
            getCityList(data.value,'cityList');
        })
        form.on('select(city)', function (data) {
            getCityList(data.value,'countryList');
        })
        form.on('select(country)', function (data) {
            getstreetList(data.value);
        })
        form.on('select(street)', function (data) {
            getparkList(data.value);
        })


        form.on('submit(register)', function(data){
            var url = baseUrl + "/registerCompany";
            var options = {
                url: url,
                type: 'post',
                dataType:'json',
                clearForm:true,
                resetForm: true,
                timeout: 10000,
                success: function (res) {
                    if (res.status == 1) {
                        layer.alert("注册成功,等待1-3个工作日审核通过后可用于登录", function (index) {
                            layer.close(index);
                        });
                    } else {
                        errmsg(res);
//                        console.log(res.msg);
                    }
                },
                error: function (data) {
                    //未登陆
                    layer.msg("系统异常");
                }
            };
            $("#parkForm").ajaxForm(options);
            $("#parkForm").submit();
            return false;
        })
        form.verify({
            mobile: [/^1[34578]\d{9}$/, '手机号有误'],
            number:[/[^1-9]/g,'该项只能输入正整数'],
            IDcard:[/^[1-9]\d{7}((0[1-9])|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0[1-9])|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/,'身份证号不合法'],
        });
        form.on('submit(registerP)', function(data){
            var url = baseUrl + "/registerPerson";
            var options = {
                url: url,
                type: 'post',
                dataType:'json',
                clearForm:true,
                resetForm: true,
                timeout: 10000,
                success: function (res) {
                    if (res.status == 1) {
                        layer.alert("注册成功,等待1-3个工作日审核通过后可使用手机号登录，密码为111111", function (index) {
                            layer.close(index);
                        });
                    } else {
                        errmsg(res);
//                        console.log(res.msg);
                    }
                },
                error: function (data) {
                    //未登陆
                    layer.msg("系统异常");
                }
            };
            $("#personalForm").ajaxForm(options);
            $("#personalForm").submit();
            return false;
        })

        window.verifyRepeat = function(obj){
            if($('#target').val()==1){
                var username = $('#account');
            }else{
                var username = $('#username');
            }
            var url = baseUrl + '/user/isExistUsername';
            $.ajax({
                url:url,
                type:'post',
                dataType:'json',
                data:{username:username.val()},
                success:function(res){
                    if(res.status==1){
//                        console.log(res.data);
                    }else{
                        layer.msg(res.msg);
                        username.val('');
                    }
                },
                error:function(res){
                    layer.msg('系统异常');
                }
            })
        }

        form.on('select(target)', function (data) {
            if(data.value==1){
                $('#choose1').css('display','block');
                $('#choose2').css('display','none');
            }else if(data.value==2){
                $('#choose2').css('display','block');
                $('#choose1').css('display','none');
            }
        })
    })
    function getProvinceList(){
        $.ajax({
            url: baseUrl + '/area/selectProvince',
            type: 'get',
            dataType: 'json',
            success: function (response) {

                if (response.status == 1) {
                    var data = response.data;
                    var html = ' <option value="">' + '请选择省份' + '</option>';
                    for (var i in data) {
                        var id = data[i].id;
                        var name = data[i].areaName;
                        html += ' <option value=' + id + '>' + name + '</option>';

                    }
                    $('#provinceList').html(html);
                    form.render();
                }else{
                    console.log(response.msg);
                }

            },
            error: function (xhr, type, errorThrown) {
                console.log(xhr.responseText);
            }
        });
    }
    function getCityList(obj,selectId){
        $.ajax({
            url: baseUrl + '/area/selectChildren',
            type: 'get',
            dataType: 'json',
            data:{id:obj},
            success: function (response) {
                response = eval(response);

                if (response.status == 1) {
                    var data = response.data;
                    console.log(data);
                    var html = ' <option value="">' + '请选择城市' + '</option>';
                    for (var i in data) {
                        var id = data[i].id;
                        var name = data[i].areaName;
                        html += ' <option value=' + id + '>' + name + '</option>';

                    }
                    $('#'+selectId).html(html);
                    form.render();
                }else{
                    console.log(response.msg);
                }

            },
            error: function (xhr, type, errorThrown) {
                console.log(xhr.responseText);
            }
        })
    }
    function getstreetList(obj){
        $.ajax({
            url: baseUrl + '/street/getStreetList',
            type: 'get',
            dataType: 'json',
            data: { id:obj},
            success: function (response) {
                response = eval(response);

                if (response.status == 1) {
                    var data = response.data;
                    var html = ' <option value="">' + '请选择街道' + '</option>';
                    for (var i in data) {
                        var id = data[i].id;
                        var name = data[i].name;
                        html += ' <option value=' + id + '>' + name + '</option>';

                    }
                    $('#streetList').html(html);
                    form.render();
                }else{
                    console.log(response.msg);
                }

            },
            error: function (xhr, type, errorThrown) {
                console.log(xhr.responseText);
            }
        })
    }
    function getparkList(obj){
        $.ajax({
            url: baseUrl + '/park/getParkList',
            type: 'get',
            dataType: 'json',
            data: { id:obj},
            success: function (response) {
                response = eval(response);

                if (response.status == 1) {
                    console.log(response.data);
                    var data = response.data;
                    var html = ' <option value="">' + '请选择园区' + '</option>';
                    for (var i in data) {
                        var id = data[i].id;
                        var name = data[i].name;
                        html += ' <option value=' + id + '>' + name + '</option>';

                    }
                    $('#parkList').html(html);
                    form.render();
                }else{
                    console.log(response.msg);
                }

            },
            error: function (xhr, type, errorThrown) {
                console.log(xhr.responseText);
            }
        })
    }

</script>
</body>
</html>