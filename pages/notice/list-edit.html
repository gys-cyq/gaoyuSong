<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="../../lib/layui/css/layui.css" />
    <link rel="stylesheet" href="../../css/style.css"  />
    <script type="text/javascript" src="../../js/main.js"></script>
    <script type="text/javascript" src="../../lib/layui/layui.js"></script>
</head>
<body>
<div class="layui-tab-brief">
    <form class="layui-form" id="expertform" style="margin-top:10px;">
        <input type="hidden" id="id" name="id" />
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">标题<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <input type="text" name="title"id="title"  lay-verify="required" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">类型<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <select name="type" lay-filter="type" id="type" lay-verify="required">
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">内容</label>
                <div class="layui-input-inline">
                    <input type="text" name="content"id="content"  autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">作者</label>
                <div class="layui-input-inline">
                    <input type="text" id="author" name="author" autocomplete="off" class="layui-input" readonly="readonly">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">通知全员<span style="color:red;">*</span></label>
            <div class="layui-input-block" id="isAll">
                <input type="radio" name="isAll" value="1" title="通知全员">
                <input type="radio" name="isAll" value="2" title="非全员" id="notAll">
            </div>
        </div>
        <div class="layui-form-item" id="userIds" style="display:none;">
            <label class="layui-form-label">通知人信息<span style="color:red;">*</span></label>
            <div class="layui-input-inline">
                <input type="text" name="userIds"  class="layui-input" id="userIdcontent">
            </div>
            <input type="button" class="layui-btn layui-btn-normal" onclick="openUserList()" value="选择">
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block" style="text-align:center;margin:0 auto;">
                <button class="layui-btn" lay-submit="" lay-filter="submit">确定</button>
                <button type="reset" class="layui-btn layui-btn-primary" onclick="cancel()">取消</button>
            </div>
        </div>
    </form>
</div>
<script type="text/javascript" src="../../js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.form.js"></script>
<script type="text/javascript">
    token = localStorage.getItem("token");
    var form;
    layui.use(['layer','form'],function(){
        form = layui.form;
        var layer = layui.layer;

        window.child = function(obj){
            console.log(obj);
            $("#id").val(obj.id);
            $("#title").val(obj.title);
            $('#type').val(obj.type);
            $('#content').val(obj.content);
            $("#author").val(obj.author);
            $(":radio[name='isAll'][value="+ obj.isAll +"]").prop("checked", "checked");
            getuserIdcontent(obj);
            getsex(obj);
        }

        $('#isAll').on('click',function(){
            if($('input:radio:checked').val()==2){
                $('#userIds').css('display','block');
            }else{
                $('#userIds').css('display','none');
            }
            console.log($(':radio[name="isAll"]:checked').val());
        })

        form.on('submit(submit)', function(data){
            var url = baseUrl + "/announcement/update";
            var options = {
                url: url,
                type: 'post',
                //clearForm:true,
                resetForm: true,
                timeout: 10000,
                data: {token: token},
//            beforeSubmit: validateForm,
                success: function (res) {
                    if (res.status == 1) {
                        layer.alert("成功", function () {
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                            parent.location.reload();
                        });
                    } else {
                        errmsg(res);
                    }
                },
                error: function (data) {
                    //未登陆
                    layer.msg("系统异常");
                }
            };
            $("#expertform").ajaxForm(options);
            $("#expertform").submit();
        })

        window.cancel = function(){
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        }
    })

    function getsex(obj){
        var html = '';
        html += '<option value="">'+'请选择'+'</option>';
        html += '<option value="1">'+'通知'+'</option>';
        html += '<option value="2">'+'公告'+'</option>';
        $('#type').html(html);
        $("#type").val(obj.type);
        form.render();
    }

//    $('#isAll').on('click',function(){
//        var userType=$('input:radio:checked');
//        if(userType.val()==2){
//            $('#userIds').css('display','block');
////            $(":radio[name='isAll'][value="+ userType.val() +"]").prop("checked", "checked");
//        }else{
//            $('#userIds').css('display','none');
////            $(":radio[name='isAll'][value="+ userType.val() +"]").prop("checked", "checked");
//            $('#userIdcontent').val("");
//        }
//    })

   function getuserIdcontent(obj){
       if(obj.isAll==2){
           $('#userIds').css('display','block');
           var userIds = obj.attList;
           var userInform='';
           for(var i=0;i<userIds.length;i++){
               if(userInform==''){
                   userInform=userIds[i].nickName;
               }else{
                   userInform=userInform +','+ userIds[i].nickName;
               }
           }
           $('#userIdcontent').val(userInform);
       }else{
           $('#userIds').css('display','none');
           $('#userIdcontent').val("");
       }
   }

    function openUserList() {
        layer.open({
            type: 2,
            title: '选择需要通知人员',
            area: ['720px', '400px'],
            fix: false,
            maxmin:true,
            content: 'user-inform.html',
            success: function (layero, index) {
//                var iframe = window['layui-layer-iframe' + index];
//                iframe.child("schoolMajor");
            },
            error: function (layero, index) {

            }
        })
    }
    function GetValue(obj) {
        var data='';
        var userInforms = '';
        console.log(obj);
        for(var i=0;i<obj.length;i++){
            if(data==''){
                data=obj[i];
            }else{
                data=data+','+obj[i];
            }
        }
        $('#userIdcontent').val(data);
    }

</script>
</body>
</html>