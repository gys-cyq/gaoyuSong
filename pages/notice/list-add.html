<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>南通科技局</title>
    <link rel="stylesheet" href="../../lib/layui/css/layui.css" />
    <link rel="stylesheet" href="../../css/style.css"  />
    <script type="text/javascript" src="../../js/main.js"></script>
    <script type="text/javascript" src="../../lib/layui/layui.js"></script>
    <style>
        .layui-form-radio>i:hover, .layui-form-radioed>i{
            color:#2fa4e7;
        }
    </style>
</head>
<body>
<div class="layui-tab-brief">
    <form class="layui-form" id="expertform" style="margin-top:10px;">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">标题<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <input type="text" name="title" id="title"  lay-verify="required" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">类型<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <select name="type" lay-filter="type" id="type" lay-verify="required">
                        <option value="">默认</option>
                        <option value="1">公告</option>
                        <option value="2">通知</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">内容<span style="color:red;">*</span></label>
            <div class="layui-input-block">
                <input type="text" name="content" id="content"  autocomplete="off" class="layui-textarea" lay-verify="required" style="width:80%;">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">通知全员<span style="color:red;">*</span></label>
            <div class="layui-input-block" id="isAll">
                <input type="radio" name="isAll" value="1" title="通知全员" checked="checked">
                <input type="radio" name="isAll" value="2" title="非全员" id="notAll">
            </div>
        </div>
        <div class="layui-form-item" id="userIds" style="display:none;">
            <label class="layui-form-label">通知人信息<span style="color:red;">*</span></label>
            <div class="layui-input-inline">
                <input type="hidden" name="userIds" />
                <input type="text"   class="layui-input" id="userIdcontent">
            </div>
            <input type="button" class="layui-btn layui-btn-normal" onclick="openUserList()" value="选择">
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block" style="text-align:center;margin:0 auto;">
                <button class="layui-btn" lay-submit="" lay-filter="submit">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary" onclick="cancel()">取消</button>
            </div>
        </div>
    </form>
</div>
<script type="text/javascript" src="../../js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.form.js"></script>
<script type="text/javascript">
    token = localStorage.getItem('token');
    layui.use(['form','layer','upload'],function(){
        var form = layui.form,
            layer = layui.layer,
            upload = layui.upload;


        form.on('submit(submit)', function(data){
            var url = baseUrl + "/announcement/add";
            var options = {
                url: url,
                type: 'post',
                dataType:'json',
                clearForm:true,
                resetForm: true,
                timeout: 10000,
                data: {token: token},
                success: function (res) {
                    if (res.status == 1) {
                        layer.alert("成功", function () {
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                            parent.location.reload();
                        });
                    } else {
                        errmsg(res);
//                        errmsg(res);
                    }
                },
                error: function (data) {
                    //未登陆
                    layer.msg("系统异常");
                }
            };
            $("#expertform").ajaxForm(options);
            $("#expertform").submit();
            return false;
        })
        window.cancel = function(){
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        }
    })

    $('#isAll').on('click',function(){
        if($('input:radio:checked').val()==2){
            $('#userIds').css('display','block');
        }else{
            $('#userIds').css('display','none');
        }
    })
    function openUserList() {
        layer.open({
            type: 2,
            title: '选择需要通知人员',
            area: ['800px', '500px'],
            fix: false,
            maxmin:true,
            content: 'user-inform.html',
            success: function (layero, index) {
//                var iframe = window['layui-layer-iframe' + index];
//                iframe.child("schoolMajor");
            },
            error: function (layero, index) {

            }
        })
    }
    function GetValue(obj,message) {
        var data='';
        var userInforms = '';
        for(var i=0;i<obj.length;i++){
            if(data==''){
                data=obj[i];
            }else{
                data=data+','+obj[i];
            }
        }
        $('#userIdcontent').val(message);
        $("input[name='userIds']").val(data);
    }
</script>
</body>
</html>