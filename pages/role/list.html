<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>崇川科技局项目管理系统</title>
    <link rel="stylesheet" href="../../static/css/font.css"  />
    <link rel="stylesheet" href="../../lib/layui/css/layui.css" />
    <link rel="stylesheet" href="../../css/style.css"  />
    <script type="text/javascript" src="../../js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../../lib/layui/layui.js"></script>
    <script type="text/javascript" src="../../js/main.js"></script>
</head>
<body>
<div class="layui-tab-brief">
    <div style="margin:10px;">
        <label class="searchTitle">角色名称</label>
        <div class="layui-input-inline">
            <input type="text"  placeholder="请输入关键字" class="layui-input search_input" name="role" id="roleSearch" autocomplete="off">
        </div>
        <a class="layui-btn search_btn" data-type="reload" id="Search">查询</a>
        <div>
            <button class="layui-btn layui-btn-small" onclick="openAddLayer()" style="margin-top:15px;" id="addbutton">
                <i class="layui-icon"></i> 添加角色
            </button>
            <button class="layui-btn" style="margin-top:15px;">权限分配</button>
        </div>
    </div>
    <fieldset class="layui-elem-field">
        <div class="layui-field-box">
            <table class="style-table" id="roleList" lay-filter="roleList">
            </table>
        </div>
    </fieldset>
    <div id="pagenum" class="pagenum"></div>
</div>
<script type="text/html" id="roleAction">

</script>
<script type="text/javascript">
layui.use(['table','layer','jquery'], function(){
    var table = layui.table,
         layer = layui.layer,
         $ = layui.jquery;
    //第一个实例
    token=localStorage.getItem("token");

    actions =localStorage.getItem("actions");
    if(actions.indexOf('menu:add')!=-1){
        $('#addbutton').css('display','inline-block');
    }else{
        $('#addbutton').css('display','none');
    }
    var html='';
    if(actions.indexOf('menu:update')!=-1){
        html+="<a class=\"layui-btn layui-btn-primary layui-btn-xs\" lay-event=\"edit\" style=\"background-color:#2fa4e7;color:#fff;\">编辑</a>"
    }
    if(actions.indexOf('menu:delete')!=-1){
        html+="<a class=\"layui-btn layui-btn-danger layui-btn-xs\" lay-event=\"del\">删除</a>"
    }
    $("#roleAction").html(html);

     table.render({
        elem: '#roleList',
        url:baseUrl+'/role/select',
        where:{token:token},
        parseData: function(res){
            return {
                "code" : 0,
                "msg" : res.msg,
                "count" : res.data.total,
                "data" : res.data.list
            }
        },
        page: true, //开启分页
        id:id,
        cols: [[ //表头
            {field: 'role', title: '角色名称'},
            {field: 'description', title: '角色描述'},
            {field:'available',templet:function(d){
                if(d.available=='1'){
                    return "可用";
                }else{
                    return "不可用";
                }
            },title:'是否可用'},
            {field:'',title:'操作',templet:function(d){
                if(d.id>5){
                    return '<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit" style="background-color:#2fa4e7;color:#fff;">编辑</a>'+
                        '<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" id="rolrDel">删除</a>';
                }else{
                    return '<span style="display:none;"></span>';
                }
            }},
        ]],
        done: function (res,cuur,count) {
            layer.closeAll('loading');
        }
    });

    var active = {
        reload :function(){
            url = baseUrl + '/role/getRoleList';
            var Srole = $('#roleSearch').val();
            table.reload(id,{
                url:url,
                method:'get',
                dataType:'json',
                page:{
                    curr:'1'
                },
                where:{
                    role:Srole
                }
            })
        }
    }

    $("#Search").on('click',function(){
        var type = $(this).data('type');
        if( $('#roleSearch').val().trim()==""){
            layer.msg('查询角色名称不能为空');
            return false;
        }
        active[type] ? active[type].call(this) : '';
    })

    window.openAddLayer = function(){
        layer.open({
            type:2,
            title:'新增角色',
            area:['450px','360px'],
            fix:false,
            content:'add.html',
            success:function(layero,index){
                var body = layui.layer.getChildFrame('body', index)
            },
            error:function(layero,index){

            }
        })
    }

    table.on("tool(roleList)",function(obj){
        console.log(111);
        var data = obj.data;
        if(obj.event==='edit'){
            layer.open({
                type:2,
                title:'编辑角色信息',
                area:['480px','360px'],
                fix:false,
                content:'edit.html',
                success:function(layero,index){
                    var body = layui.layer.getChildFrame('body', index);
                    body.find('#id').val(data.id);
                    body.find('#roleName').val(data.role);
                    body.find('#roleDes').val(data.description);
                    body.find("#roleab").val(data.available);
                },
                error:function(layero,index){

                }
            })
        }
    })

});
</script>
</body>
</html>
