<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	    <meta name="viewport" content="width=device-width,initial-scale=1.0">
	    <meta name="apple-mobile-web-app-status-bar-style" content="black"> 
	  	<meta name="apple-mobile-web-app-capable" content="yes">
	  	<meta name="format-detection" content="telephone=no">
		<title>南通科技局</title>
		<link rel="stylesheet" href="../../static/css/font.css"  />
		<link rel="stylesheet" href="../../static/css/weadmin.css"  />
		<link rel="stylesheet" href="../../css/style.css"  />
		<script type="text/javascript" src="../../js/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="../../lib/layui/layui.js"></script>
	</head>
	<body>
		<div class="layui-tab-brief">
	        <fieldset class="layui-elem-field">
	            <div class="layui-field-box">
					<table class="style-table"><tbody id="rootContent"></tbody></table>
	            </div>
	        </fieldset>
			<div style="text-align:center;margin-top:20px;">
				<button class="layui-btn" onclick="submit()" id="saveDataBtn">保存</button>
				<button class="layui-btn" style="background:#eee;color:#000;" onclick="cancel()">取消</button>
			</div>
		</div>
		<script type="text/javascript">
            $.ajax({
				url:'../../json/root.json',
                type:"get",
                dataType:"json",
                success:function(data){
                    var html="";
                    for(var i in data){
						html += "<tr>";
						html+="<th><input type='checkbox' value='+data[i].num+' />"+data[i].name+"</th>";
						if(data[i].child){
						    html+="<th>"
						    html+="<table class='style-table'><tbody>";
						    for(var key in data[i].child){
                                html+="<tr>";
						        html+="<th><input type='checkbox' value='+(data[i].child)[key].num+' />"+(data[i].child)[key].name+"</th>";
//						        var data=(data[i].child)[key];
						        if((data[i].child)[key].child){
						            html+="<th>";
						            html+="<table class='style-table'><tbody>";
						            for(var j in (data[i].child)[key].child){
						                html+="<tr>";
                                        html+="<th><input type='checkbox' value='+((data[i].child)[key].child)[j].num+' />"+((data[i].child)[key].child)[j].name+"</th>";
						                html+="</tr>";
									}
						            html+="</tbody></table>";
						            html+="</th>"
								}
                                html+="</tr>";
							}
							html+="</tbody></table>"
							html+="</th>"
						}
						html+="</tr>";

//						console.log(data[i].name);
					}
                    $("#rootContent").html(html);

                    function getCookie(name){
                        var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)"); //正则匹配
                        if(arr = document.cookie.match(reg)){
                            return unescape(arr[2]);
                        }else{
                            return null;
                        }
                    }
                    function searchData(){
                        var saveData = '';
                        $("body").find("input").each(function(i){
                            if($(this).is(':checked')){
                                saveData += $(this).val() + "|";
                            }
                        });
                        return saveData;
                    }
                    function setCookie(name,value) {
                        document.cookie = name + '=' + escape(value);
                    }

                    var rootChoices = document.cookie.indexOf("rootChoices");
                    if(rootChoices == -1){
                        // 本地cookie不存在 ，什么也不做，不读取
                    }else{
                        // 读取cooke内容
                        var loaclCookie = getCookie("rootChoices");
                        // 写入浏览器渲染
                        var cookieArr = loaclCookie.split('|');
                        for (var i = 0 ; i < cookieArr.length - 1; i++){
//						$("#" + cookieArr[i]).prop("checked",true);
                            $("input[value='" + cookieArr[i] + "']").prop("checked",true);

                        }

                    }

                    $('input').click(function() {
//                        var c = $(this).is(':checked');
						if($(this).is(':checked')){
                            $(this).parents("th").siblings().find("input").prop("checked", true);
						}else{
                            $(this).parents("th").siblings().find("input").prop("checked", false);
						}

                        $('#saveDataBtn').click(function(){
                            var saveData=searchData();
                            setCookie("rootChoices",saveData);
						})
                    })
                },
                error:function(xhr,type,errorThrown){
                    console.log("请求失败");
                    console.log(xhr.status);
                }

            });
			layui.use(['jquery','layer'],function(){
				var layer=layui.layer,
				$=layui.jquery;
				window.cancel=function(){
					var index = parent.layer.getFrameIndex(window.name);
					parent.layer.close(index);
				}
				window.submit=function(){
					var index = parent.layer.getFrameIndex(window.name);
					parent.layer.close(index);
				}
			})
		</script>
	</body>
</html>
