<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>南通科技局</title>
    <link rel="stylesheet" href="../../lib/layui/css/layui.css" />
    <script type="text/javascript" src="../../js/main.js"></script>
    <style>
        .layui-form{
            text-align:center;
        }
        .layui-form-label{
            width:90px;
        }
    </style>
</head>
<body>
<div class="layui-tab-brief">
    <form class="layui-form" id="patentEditform" style="margin-top:10px;">
        <input type="hidden" id="id" name="id" />
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">专利号<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <input type="text" name="number"id="number"  lay-verify="required" autocomplete="off" class="layui-input" onchange="numberRepeat()">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">专利类型<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <!--<input type="text" name="typeName"id="type"  lay-verify="required" autocomplete="off" class="layui-input">-->
                    <select lay-filter="type" name="type" id="type">

                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item" style="margin-left:13%;">
            <label class="layui-form-label">专利名称<span style="color:red;">*</span></label>
            <div class="layui-input-block">
                <input type="text" name="name"id="name"  lay-verify="required" autocomplete="off" class="layui-input" style="width:79%;">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">申请人<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <input type="text" name="applyUserName"id="applyUserName"  autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">申请人街道</label>
                <div class="layui-input-inline">
                    <!--<input type="text" name="applyStreet" id="applyStreet"  autocomplete="off" class="layui-input">-->
                    <select type="text" name="applyStreet" id="applyStreet"></select>
                </div>
            </div>
        </div>
        <div class="layui-form-item" style="margin-left:13%;">
                <label class="layui-form-label">申请人地址</label>
                <div class="layui-input-block">
                    <input type="text" name="applyAddress" id="applyAddress"  autocomplete="off" class="layui-input" style="width:79%;">
                </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">专利权人<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <!--<input type="text" name="authorizerUserName" id="authorizerUserName" autocomplete="off" class="layui-input" lay-verify="required">-->
                    <input type="text" name="authorizerUserName" id="authorizerUserName" autocomplete="off" class="layui-input"  readonly="readonly" lay-verify="required" onclick="openUserList()">
                    <input type="hidden" name="userId" id="authorizerUserName2" />
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">联系电话</label>
                <div class="layui-input-inline">
                    <input type="text" name="tel" id="tel"  autocomplete="off" class="layui-input" lay-verify="linkTel">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">所在街道</label>
                <div class="layui-input-inline">
                    <select lay-filter="authorizerStreet" name="authorizerStreet" id="authorizerStreet"></select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">专利权人地址</label>
                <div class="layui-input-inline">
                    <input type="text" name="authorizerAddress" id="authorizerAddress" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">申请日期<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <input type="text" name="applyDate" id="applyDate" autocomplete="off" class="layui-input time" lay-verify="required">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">有效期（年）</label>
                <div class="layui-input-inline">
                    <input type="text" name="validityPeriod" id="validityPeriod" autocomplete="off" class="layui-input" onkeyup="num(this)" onblur="num(this)">
                </div>
            </div>
            <!--<div class="layui-inline">-->
                <!--<label class="layui-form-label">专利类型名称<span style="color:red;">*</span></label>-->
                <!--<div class="layui-input-inline">-->
                    <!--<input type="text" name="typeName" id="typeName" autocomplete="off" class="layui-input" lay-verify="required">-->
                <!--</div>-->
            <!--</div>-->
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">授权日期<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <input type="text" name="authorizerDate" id="authorizerDate"  autocomplete="off" class="layui-input time" lay-verify="required">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">创建时间<span style="color:red;">*</span></label>
                <div class="layui-input-inline">
                    <input type="text" name="createTime" id="createTime" autocomplete="off" class="layui-input" lay-verify="required">
                </div>
            </div>

        </div>
        <div class="layui-form-item layui-form-text"  style="margin-left:13%;">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block">
                <textarea placeholder="请输入内容" class="layui-textarea" id="remark" name="remark" style="width:79%;"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block" style="text-align:center;margin:0 auto;">
                <button class="layui-btn" onclick="patentEdit()">确定</button>
                <button class="layui-btn" style="background:#eee;color:#000;" onclick="cancel()">取消</button>
            </div>
        </div>
    </form>
</div>
<script type="text/javascript" src="../../js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.form.js"></script>
<script type="text/javascript" src="../../lib/layui/layui.js"></script>
<script type="text/javascript">
    token = localStorage.getItem("token");
    var form;


     function child(obj){
         layui.use(['form','layer','laydate'],function(){
             form = layui.form;
             var layer = layui.layer,
                 laydate = layui.laydate;

             lay('.time').each(function() {
                 laydate.render({
                     elem:this,
                 });
             })
             form.verify({
                 linkTel: [/^$|^1[34578]\d{9}$|^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/, '联系方式有误'],
             })

             window.cancel = function(){
                 var index = parent.layer.getFrameIndex(window.name);
                 parent.layer.close(index);
             }

             window.patentEdit = function(){
                 var url = baseUrl + "/patent/update";
                 var options = {
                     url: url,
                     type: 'post',
                     dataType:'json',
                     resetForm: true,
                     timeout: 10000,
                     data: {token: token},
                     success: function (res) {
                         if (res.status == 1) {
                             layer.alert("成功", function () {
                                 var index = parent.layer.getFrameIndex(window.name);
                                 parent.layer.close(index);
//                        parent.location.reload();
                             });
                         } else {
                             errmsg(res);
                         }
                     },
                     error: function (data) {
                         //未登陆
                         layer.msg("系统异常");
                     }
                 };
                 $("#patentEditform").ajaxForm(options);
                 $("#patentEditform").submit();
                 return false;
             }

             $('#id').val(obj.id);
             $('#type').val(obj.typeName);
             $('#number').val(obj.number);
             $('#name').val(obj.name);
             $('#applyUserName').val(obj.applyUserName);
             $('#applyAddress').val(obj.applyAddress);
             $('#applyStreet').val(obj.applyStreet);
             $('#authorizerUserName').val(obj.authorizerUserName);
             $('#authorizerDate').val(obj.authorizerDate);
             $('#authorizerAddress').val(obj.authorizerAddress);
             $('#authorizerStreet').val(obj.authorizerStreet);
             $('#tel').val(obj.tel);
             $('#validityPeriod').val(obj.validityPeriod);
             $('#remark').val(obj.remark);
             $('#createTime').val(obj.createTime);
             $('#typeName').val(obj.typeName);
             $('#applyDate').val(obj.applyDate);

             getStreetList(obj);
             getPatentType(obj);
         })


     }

//    $('#patentEdit').on('click',function(){
//
//    })
    function getPatentType(obj){
        $.ajax({
            url:baseUrl + '/patentType/findpatentTypeAll',
            type:'get',
            dataType:'json',
            data:{token:token},
            success:function(res){
                if(res.status==1){
                    var data = res.data;
                    var html = '<option value="">'+'请选择'+'</option>';
                    for(var i=0;i<data.length;i++){
                        var id = data[i].id;
                        var typeName = data[i].typeName;
                        html += '<option value=' + id + '>'+typeName+'</option>';
                    }
                    $('#type').html(html);
                    $('#type').val(obj.type);
                    form.render();
                }
            },
            error:function(res){

            }
        })
    }

    function getStreetList(obj){
        $.ajax({
            url: baseUrl + '/street/getStreetList',
            type: 'get',
            dataType: 'json',
            data: { token: token },
            success: function (response) {
                response = eval(response);
                try {
                    if (response.status == 1) {
                        var data = response.data;
                        var html = ' <option value="">' + '请选择街道' + '</option>';
                        for (var i in data) {
                            var id = data[i].id;
                            var name = data[i].name;
                            html += ' <option value=' + id + '>' + name + '</option>';

                        }

                        $('#authorizerStreet').html(html);
                        $('#authorizerStreet').val(obj.authorizerStreet);
                        $('#applyStreet').html(html);
                        $('#applyStreet').val(obj.applyStreet);
                        form.render();
                    }
                } catch (e) {
                    console.log(e.message);

                }

            },
            error: function (xhr, type, errorThrown) {
                console.log(xhr.responseText);
            }
        });
    }
    function numberRepeat(){
        var url = baseUrl + '/patent/findPatentAll';
        $.ajax({
            url:url,
            type:'get',
            data:{token:token},
            success:function(res){
                if(res.status==1){
                    var data = res.data;
                    for(var i = 0;i<data.length;i++){
                        if($('#number').val()==data[i].number){
                            layer.msg('专利编号已存在');
                            $('#number').val('');
                            return false;
                        }
                    }
                }else{
                    errmsg(res);
                }
            },
            error:function(res){
                layer.msg('系统异常');
            }
        })
    }
    function openUserList() {
        layer.open({
            type: 2,
            title: '选择专利权人',
            area: ['700px', '450px'],
            fix: false,
            maxmin:true,
            content: 'list-inform.html',
            success: function (layero, index) {
//                var iframe = window['layui-layer-iframe' + index];
//                iframe.child("schoolMajor");
            },
            error: function (layero, index) {

            }
        })
    }
    function GetValue(obj,message) {
        $('#authorizerUserName').val(message);
        $('#authorizerUserName2').val(obj);
    }
</script>
</body>
</html>